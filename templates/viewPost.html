<!DOCTYPE html>
<html>
<head>
    <!-- Sayfa baÅŸlÄ±ÄŸÄ± -->
    <title>{{.Post.Title}}</title>
    <!-- Viewpost sayfasÄ± iÃ§in genel viewport ayarÄ± -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Sayfa stil dosyasÄ± -->
    <link rel="stylesheet" type="text/css" href="/static/css/viewpost.css">
    <link rel="stylesheet" type="text/css" href="/static/css/bar.css">

    <!-- jQuery kÃ¼tÃ¼phanesi -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<body>
    <script src="/static/scripts.js"></script>
    <!-- Ãœst Ã‡ubuk-->
    <div id="bigbar">
        <div id="dÃ¼zenbar">
            <div id="bar">
                <!-- Logo -->
                <a href="index.html" id="logo" style="background-image: url('/static/png/logo.png'); background-repeat: no-repeat; background-size: contain;"></a>

                <!-- Arama kutusu -->
                <input type="text" id="searchBox" placeholder="search now" onkeyup="searchLanguages()">
                
                <!-- Tema deÄŸiÅŸtirme dÃ¼ÄŸmesi -->
                <div id="darkmod">
                    <span class="theme-mode">
                        <a role="button" id="themeToggle" title="Tema DeÄŸiÅŸtir" href="javascript:void(0);">ðŸŒ“
                        <i id="themeIcon" class="fas fa-sun"></i></a> 
                    </span>
                </div>
                <div id="giriÅŸbar">
                    <nav>
                        <!-- GiriÅŸ durumuna gÃ¶re menÃ¼ -->
                        {{if .LoggedIn}}
                        <div id="myprofil">
                            <a href="/myprofil"><img width="80%" height="100%" src="/static/png/pp.png"></a>
                        </div>
                        <a href="/logout" id="logoutButton" class="button">Log Out</a>
                        <!-- HoÅŸ geldiniz popup'Ä± -->
                        <script>
                            // EÄŸer popup daha Ã¶nce gÃ¶sterilmemiÅŸse gÃ¶ster
                            if (!localStorage.getItem('popupGosterildi')) {
                                const welcomePopup = document.createElement('div');
                                welcomePopup.innerHTML = `
                                    <div id="welcomePopup" style="position: fixed; top: 0; left: 0; width: 100%; height: 15%;  display: flex; justify-content: center; align-items: center; z-index: 9999;">
                                        <div id="popup" style="background-color: white; padding: 10px; border-radius: 10px; box-shadow: 0 0 10px rgba(0, 0, 0, 0.3); color: black;">
                                            <h4>HoÅŸ geldiniz!</h4>
                                            <p>Sitemize giriÅŸ yaptÄ±ÄŸÄ±nÄ±z iÃ§in teÅŸekkÃ¼r ederiz.</p>
                                        </div>
                                    </div>
                                `;
                                document.body.appendChild(welcomePopup);

                                // Tema moduna gÃ¶re popup rengini ayarla
                                const popupElement = welcomePopup.querySelector('#popup');
                                const theme = localStorage.getItem("tema") || "light"; // EÄŸer tema daha Ã¶nce kaydedilmiÅŸse kullan, yoksa "light"
                                if (theme === "dark") {
                                    popupElement.style.backgroundColor = "rgb(239, 242, 246)";
                                    popupElement.style.color = "black";
                                } else {
                                    popupElement.style.backgroundColor = "rgb(20, 25, 31)";
                                    popupElement.style.color = "white";
                                }

                                // Pop-up'Ä± kapatmak iÃ§in bir zamanlayÄ±cÄ± kullan
                                setTimeout(() => {
                                    welcomePopup.remove(); // Pop-up'Ä± kapat
                                }, 1500);

                                // Popup'Ä±n gÃ¶sterildiÄŸini iÅŸaretle
                                localStorage.setItem('popupGosterildi', 'true');
                            }

                            // Ã‡Ä±kÄ±ÅŸ yap butonuna tÄ±klandÄ±ÄŸÄ±nda onay popup'Ä± gÃ¶ster ve localStorage'Ä± temizle
                            document.querySelector('#logoutButton').addEventListener('click', function (event) {
                                event.preventDefault(); // BaÄŸlantÄ±nÄ±n varsayÄ±lan davranÄ±ÅŸÄ±nÄ± engelle (sayfayÄ± yenileme)

                                // Onay popup'Ä±nÄ± gÃ¶ster
                                if (confirm('Are you sure you want to log out?')) {
                                    // localStorage'Ä± temizle
                                    localStorage.removeItem('popupGosterildi');

                                    // KullanÄ±cÄ± evet derse, logout sayfasÄ±na git
                                    window.location.href = this.getAttribute('href');
                                }
                            });
                        </script>
                        {{else}}
                        <a href="/login" class="button">Log In</a>
                        <a href="/register" class="button">Register</a>
                        {{end}}
                    </nav>
                </div>
            </div>
        </div>
    </div>
    <!-- GÃ¶rÃ¼nmez bar -->
    <div id="gÃ¶rÃ¼nmezbar"></div>
    <div id="gÃ¶rÃ¼nmezbar"></div>
    <!-- Merkez alanÄ± -->
    <div id="center">
        <div id="centercont">
            <!-- KullanÄ±cÄ± profil bilgileri -->
            <div id="centerprofilcont">
                <div id="profil">
                    <img src="/static/png/pp.png">
                </div>
                <div id="name">
                    {{.Post.Username}}
                </div>
            </div>
            <!-- GÃ¶nderi baÅŸlÄ±ÄŸÄ± ve iÃ§eriÄŸi -->
            <div id="centersorubaslik">
                {{if .Post.ImagePath}}
                <img id="postImage" src="/uploads/{{.Post.ImagePath}}" alt="Post Image" onclick="openImageModal()"> 
                {{end}}
                <h3>{{.Post.Title}}</h3>
                <div class="text-block">
                    <p>{{.Post.Content}}</p>
                </div>
                <!-- GÃ¶nderi oluÅŸturulma tarihi ve beÄŸeni/beÄŸenmeme sayÄ±larÄ± -->
                <p>{{.Post.CreatedAtFormatted}} Likes: <span id="post-like-count">{{.Post.LikeCount}}</span> Dislikes: <span id="post-dislike-count">{{.Post.DislikeCount}}</span></p>
                
                <!-- BeÄŸeni ve beÄŸenmeme dÃ¼ÄŸmeleri -->
                <div id="like">
                    <button onclick="vote('{{.Post.ID}}', null, 1)"><img src="/static/png/like.png" alt="Like"></button>
                </div> 
                <div id="dislike">
                    <button onclick="vote('{{.Post.ID}}', null, -1)"><img src="/static/png/dislike.png" alt="Dislike"></button>
                </div>
                <!-- GÃ¶nderi silme formu -->
                <form id="deletePostForm" action="/deletePost" method="post">
                    <input type="hidden" name="post_id" value="{{.Post.ID}}">
                    <button type="submit">
                        <img src="/static/png/delete.png" alt="Delete">
                    </button>
                </form>
            </div>
        </div>

        <!-- Yorumlar -->
        {{range .Comments}}
        <div id="centercont">
            <div id="centerprofilcont">
                <div id="profil">
                    <img src="/static/png/pp.png">
                </div>
                <div id="name">
                    {{.Username}}
                </div>
            </div>
            <div id="centersorubaslik">
                <!-- Yorum iÃ§eriÄŸi -->
                <p>{{.Content}}</p>
                <div id="centercont">
                    <div id="centersorubaslik">
                        {{if .ImagePath}}
                        <img id="commentImage-{{.ID}}" src="/uploads/{{.ImagePath}}" alt="Comment Image" onclick="openImageModal('commentImage-{{.ID}}')">
                        {{end}}
                    </div>
                </div>
                <!-- Yorumun oluÅŸturulma tarihi -->
                <small>Commented by {{.Username}} on {{.CreatedAtFormatted}}</small>
                <!-- Yorumun beÄŸeni ve beÄŸenmeme sayÄ±larÄ± -->
                <p>Likes: <span id="comment-like-count-{{.ID}}">{{.LikeCount}}</span> Dislikes: <span id="comment-dislike-count-{{.ID}}">{{.DislikeCount}}</span></p>
                <!-- Yorum beÄŸeni ve beÄŸenmeme dÃ¼ÄŸmeleri -->
                <div id="like">
                    <button onclick="vote(null, '{{.ID}}', 1)"><img src="/static/png/like.png" alt="Like"></button>
                </div>
                <div id="dislike">
                    <button onclick="vote(null, '{{.ID}}', -1)"><img src="/static/png/dislike.png" alt="Dislike"></button>
                </div>
                <!-- Yorum silme formu -->
                <form id="deletePostForm" action="/deleteComment" method="post">
                    <input type="hidden" name="comment_id" value="{{.ID}}">
                    <button type="submit">
                        <img src="/static/png/delete.png" alt="Delete">
                    </button>
                </form>
            </div>
        </div>
        {{end}}

        <!-- Yorum formu -->
        {{if .LoggedIn}}
        <form id="commentForm" action="/submitComment" method="post" enctype="multipart/form-data">
            <input type="hidden" name="post_id" value="{{.Post.ID}}">
            <textarea name="content" placeholder="Write a comment"></textarea>
            <input type="file" name="image">
            <button type="submit">Submit Comment</button>
        </form>
        {{end}}
    </div>
</body>
<script>
    // Yorum ve gÃ¶nderi beÄŸeni/beÄŸenmeme fonksiyonu
    function vote(postID, commentID, voteValue) {
        const url = postID ? '/votePost' : '/voteComment';
        const data = postID ? { post_id: postID, vote: voteValue } : { comment_id: commentID, vote: voteValue };

        $.ajax({
            type: 'POST',
            url: url,
            data: JSON.stringify(data),
            contentType: 'application/json',
            success: function(response) {
                if (response.success) {
                    const likeCount = response.likeCount;
                    const dislikeCount = response.dislikeCount;
                    if (postID) {
                        $(`#post-like-count`).text(likeCount);
                        $(`#post-dislike-count`).text(dislikeCount);
                    } else {
                        $(`#comment-like-count-${commentID}`).text(likeCount);
                        $(`#comment-dislike-count-${commentID}`).text(dislikeCount);
                    }
                }
            },
            error: function(xhr, status, error) {
                console.error('An error occurred:', error);
            }
        });
    }
</script>
<script>
    // Resim bÃ¼yÃ¼tme fonksiyonu
    function openImageModal(imageId) {
        var img = document.getElementById(imageId);
        var modal = document.getElementById("imageModal");
        var modalImg = document.getElementById("modalImage");
        modal.style.display = "block";
        modalImg.src = img.src;
    }

    function closeImageModal() {
        var modal = document.getElementById("imageModal");
        modal.style.display = "none";
    }
</script>
</html>
